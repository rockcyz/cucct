<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>字符编码查看器 | 计算思维概论</title>
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome 6（与 index.html 保持一致） -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- 使用TextEncoder和手动编码处理 -->

  <script>
    // 使用本地编码映射表
    console.log('使用本地编码映射表进行字符编码');

    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CBCB',
            accent: '#FF5252',
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style>
    html { scroll-behavior: smooth; }
    body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen text-gray-700 font-sans">
  <!-- Header（与首页风格统一） -->
  <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-6 py-4">
      <nav class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
            <span class="text-white font-bold text-lg">💡</span>
          </div>
          <a href="index.html" class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            计算思维概论
          </a>
        </div>
        <div class="hidden md:flex space-x-6">
          <a href="index.html#courses" class="text-gray-600 hover:text-blue-600 transition-colors">课程内容</a>
          <a href="index.html#lab-tools" class="text-gray-600 hover:text-blue-600 transition-colors">实验工具</a>
          <a href="faq.html" class="text-gray-600 hover:text-blue-600 transition-colors">常见问题</a>
          <a href="knowledge-graph.html" class="text-gray-600 hover:text-blue-600 transition-colors">知识图谱</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Page Hero -->
  <section class="py-6 px-4">
    <div class="container mx-auto">
      <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-5">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <div class="inline-flex items-center bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium mb-3">
              实验工具 · 字符编码
            </div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900 flex items-center gap-2">
              <i class="fas fa-code text-blue-600"></i>
              字符编码查看器
            </h1>
            <p class="text-gray-600 mt-2">支持 Unicode、UTF-8、UTF-16、ASCII 等编码的查看与说明</p>
          </div>
          <div class="flex items-center gap-2">
            <a href="index.html" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded-xl font-semibold hover:shadow-lg transition-all transform hover:scale-105 text-sm">
              <i class="fas fa-home mr-2"></i>返回主页
            </a>
            <button id="help-btn" class="bg-white text-blue-600 border border-blue-200 px-4 py-2 rounded-xl font-semibold hover:bg-blue-50 transition-all text-sm">
              <i class="fas fa-circle-question mr-2"></i>使用帮助
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main -->
  <main class="container mx-auto px-4 pb-10">
    <!-- 输入卡片 -->
    <div class="bg-white rounded-2xl shadow-xl p-5 mb-6">
      <h2 class="text-xl font-semibold mb-4 text-gray-900">字符输入</h2>
      <div class="flex flex-col md:flex-row items-center gap-3">
        <label for="char-input" class="text-sm font-medium text-gray-700 md:w-24">请输入一个字符：</label>
        <input type="text" id="char-input" maxlength="1" class="flex-1 max-w-sm border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 text-base" placeholder="输入任意一个字符">
        <button id="convert-btn" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold py-2 px-5 rounded-xl transition-all transform hover:scale-105 hover:shadow-lg whitespace-nowrap text-sm">
          <i class="fas fa-right-left mr-2"></i>转换编码
        </button>
      </div>
      <p class="mt-2 text-xs text-gray-500"><i class="fas fa-circle-info mr-1"></i> 请输入单个字符，系统将自动转换并显示其各种编码格式</p>
    </div>

    <!-- 结果网格 -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <!-- Unicode -->
      <div class="bg-white rounded-2xl shadow-xl p-5">
        <h3 class="text-lg font-semibold mb-3 text-gray-900 flex items-center">
          <i class="fas fa-flag mr-2 text-blue-600"></i>Unicode编码
        </h3>
        <div class="space-y-2">
          <div>
            <p class="text-sm text-gray-600 mb-1">十进制表示：</p>
            <div id="unicode-dec" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">十六进制表示：</p>
            <div id="unicode-hex" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">代码点表示：</p>
            <div id="unicode-codepoint" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
        </div>
      </div>

      <!-- UTF-8 -->
      <div class="bg-white rounded-2xl shadow-xl p-5">
        <h3 class="text-lg font-semibold mb-3 text-gray-900 flex items-center">
          <i class="fas fa-file-lines mr-2 text-blue-600"></i>UTF-8编码
        </h3>
        <div class="space-y-2">
          <div>
            <p class="text-sm text-gray-600 mb-1">二进制表示：</p>
            <div id="utf8-bin" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">十六进制表示：</p>
            <div id="utf8-hex" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">字节长度：</p>
            <div id="utf8-length" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
        </div>
      </div>

      <!-- UTF-16 -->
      <div class="bg-white rounded-2xl shadow-xl p-5">
        <h3 class="text-lg font-semibold mb-3 text-gray-900 flex items-center">
          <i class="fas fa-file-code mr-2 text-blue-600"></i>UTF-16编码
        </h3>
        <div class="space-y-2">
          <div>
            <p class="text-sm text-gray-600 mb-1">二进制表示：</p>
            <div id="utf16-bin" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">十六进制表示：</p>
            <div id="utf16-hex" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">字节长度：</p>
            <div id="utf16-length" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
        </div>
      </div>


      <!-- ASCII -->
      <div class="bg-white rounded-2xl shadow-xl p-5">
        <h3 class="text-lg font-semibold mb-3 text-gray-900 flex items-center">
          <i class="fas fa-asterisk mr-2 text-blue-600"></i>ASCII编码
        </h3>
        <div class="space-y-2">
          <div>
            <p class="text-sm text-gray-600 mb-1">十进制表示：</p>
            <div id="ascii-dec" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">十六进制表示：</p>
            <div id="ascii-hex" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">二进制表示：</p>
            <div id="ascii-bin" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">字符说明：</p>
            <div id="ascii-char" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
        </div>
      </div>

    </div>

    <!-- 字符信息 -->
    <div class="bg-white rounded-2xl shadow-xl p-5">
      <h3 class="text-base font-semibold mb-3 text-gray-900 flex items-center">
        <i class="fas fa-circle-info mr-2 text-blue-600"></i>字符信息
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <p class="text-sm text-gray-600 mb-1">输入的字符：</p>
          <div id="char-display" class="text-4xl font-bold text-center py-4 bg-gray-50 rounded-md">--</div>
        </div>
        <div class="space-y-2">
          <div>
            <p class="text-sm text-gray-600 mb-1">字符名称：</p>
            <div id="char-name" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">所属Unicode区块：</p>
            <div id="char-block" class="font-mono bg-gray-100 p-3 rounded-md overflow-x-auto text-sm">--</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 帮助模态框 -->
  <div id="help-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-gray-900">使用说明</h2>
        <button id="close-help-btn" class="text-gray-400 hover:text-gray-600 transition-colors">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      <div class="space-y-4 text-gray-700">
        <div>
          <h3 class="font-semibold text-blue-600">功能介绍</h3>
          <p>本工具用于查看单个字符的多种编码表示形式，包括Unicode、UTF-8、UTF-16及ASCII的相关信息。</p>
        </div>
        <div>
          <h3 class="font-semibold text-blue-600">使用方法</h3>
          <ol class="list-decimal pl-5 space-y-2">
            <li>在输入框中输入任意单个字符（中文、英文、数字、符号等均可）</li>
            <li>点击「转换编码」按钮或按回车键</li>
            <li>查看页面上显示的各种编码格式</li>
          </ol>
        </div>
        <div>
          <h3 class="font-semibold text-blue-600">编码说明</h3>
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>Unicode</strong>：统一码，为每种语言中的每个字符设定了统一且唯一的二进制编码</li>
            <li><strong>UTF-8</strong>：针对Unicode的可变长度字符编码，使用1-4个字节表示一个字符</li>
            <li><strong>UTF-16</strong>：使用2或4个字节表示一个字符的Unicode编码方式</li>
            <li><strong>ASCII</strong>：使用7或8位二进制表示，用于英文及控制字符</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer（与首页统一） -->
  <footer class="bg-gray-900 text-white py-12 px-6">
    <div class="container mx-auto text-center">
      <p class="text-lg">
        <i class="fas fa-code"></i> Built with passion for Computational Thinking Education
      </p>
      <p class="text-gray-400 mt-2">© 2025 CUC Introduction to Computational Thinking Course Website</p>
    </div>
  </footer>

  <!-- 交互脚本（保留原逻辑） -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const charInput = document.getElementById('char-input');
      const convertBtn = document.getElementById('convert-btn');
      const unicodeDec = document.getElementById('unicode-dec');
      const unicodeHex = document.getElementById('unicode-hex');
      const unicodeCodepoint = document.getElementById('unicode-codepoint');
      const utf8Bin = document.getElementById('utf8-bin');
      const utf8Hex = document.getElementById('utf8-hex');
      const utf8Length = document.getElementById('utf8-length');
      const utf16Bin = document.getElementById('utf16-bin');
      const utf16Hex = document.getElementById('utf16-hex');
      const utf16Length = document.getElementById('utf16-length');
      const asciiDec = document.getElementById('ascii-dec');
      const asciiHex = document.getElementById('ascii-hex');
      const asciiBin = document.getElementById('ascii-bin');
      const asciiChar = document.getElementById('ascii-char');
      const charDisplay = document.getElementById('char-display');
      const charName = document.getElementById('char-name');
      const charBlock = document.getElementById('char-block');
      const helpBtn = document.getElementById('help-btn');
      const helpModal = document.getElementById('help-modal');
      const closeHelpBtn = document.getElementById('close-help-btn');

      // 帮助模态框
      helpBtn.addEventListener('click', () => {
        helpModal.classList.remove('hidden');
        helpModal.classList.add('flex');
        document.body.style.overflow = 'hidden';
      });
      const closeHelp = () => {
        helpModal.classList.add('hidden');
        helpModal.classList.remove('flex');
        document.body.style.overflow = 'auto';
      };
      closeHelpBtn.addEventListener('click', closeHelp);
      helpModal.addEventListener('click', function(e) {
        if (e.target === helpModal) closeHelp();
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') closeHelp();
      });

      function toBinary(num, bits) {
        return num.toString(2).padStart(bits, '0');
      }
      function toHex(num, bits) {
        return num.toString(16).toUpperCase().padStart(bits, '0');
      }

      function getUTF8Bytes(char) {
        const bytes = [];
        const codePoint = char.codePointAt(0);
        if (codePoint < 0x80) {
          bytes.push(codePoint);
        } else if (codePoint < 0x800) {
          bytes.push(0xC0 | (codePoint >> 6));
          bytes.push(0x80 | (codePoint & 0x3F));
        } else if (codePoint < 0x10000) {
          bytes.push(0xE0 | (codePoint >> 12));
          bytes.push(0x80 | ((codePoint >> 6) & 0x3F));
          bytes.push(0x80 | (codePoint & 0x3F));
        } else {
          bytes.push(0xF0 | (codePoint >> 18));
          bytes.push(0x80 | ((codePoint >> 12) & 0x3F));
          bytes.push(0x80 | ((codePoint >> 6) & 0x3F));
          bytes.push(0x80 | (codePoint & 0x3F));
        }
        return bytes;
      }
      function getUTF16Bytes(char) {
        const bytes = [];
        const codePoint = char.codePointAt(0);
        if (codePoint < 0x10000) {
          bytes.push((codePoint >> 8) & 0xFF);
          bytes.push(codePoint & 0xFF);
        } else {
          const code = codePoint - 0x10000;
          const highSurrogate = 0xD800 | ((code >> 10) & 0x3FF);
          const lowSurrogate = 0xDC00 | (code & 0x3FF);
          bytes.push((highSurrogate >> 8) & 0xFF);
          bytes.push(highSurrogate & 0xFF);
          bytes.push((lowSurrogate >> 8) & 0xFF);
          bytes.push(lowSurrogate & 0xFF);
        }
        return bytes;
      }

      // 取消本地映射表，避免不完整导致的误判


      function getCharacterName(char) {
        const codePoint = char.codePointAt(0);
        const names = {
          'a':'LATIN SMALL LETTER A','b':'LATIN SMALL LETTER B','c':'LATIN SMALL LETTER C',
          '0':'DIGIT ZERO','1':'DIGIT ONE','@':'COMMERCIAL AT',
          '中':'CJK UNIFIED IDEOGRAPH-4E2D','文':'CJK UNIFIED IDEOGRAPH-6587','字':'CJK UNIFIED IDEOGRAPH-5B57',
        };
        return names[char] || `CHARACTER ${toHex(codePoint, 4)}`;
      }
      function getUnicodeBlock(char) {
        const cp = char.codePointAt(0);
        if (cp >= 0x0000 && cp <= 0x007F) return 'Basic Latin';
        if (cp >= 0x0080 && cp <= 0x00FF) return 'Latin-1 Supplement';
        if (cp >= 0x0370 && cp <= 0x03FF) return 'Greek and Coptic';
        if (cp >= 0x0400 && cp <= 0x04FF) return 'Cyrillic';
        if (cp >= 0x2000 && cp <= 0x206F) return 'General Punctuation';
        if (cp >= 0x2200 && cp <= 0x22FF) return 'Mathematical Operators';
        if (cp >= 0x2300 && cp <= 0x23FF) return 'Miscellaneous Technical';
        if (cp >= 0x25A0 && cp <= 0x25FF) return 'Geometric Shapes';
        if (cp >= 0x2600 && cp <= 0x26FF) return 'Miscellaneous Symbols';
        if (cp >= 0x2700 && cp <= 0x27BF) return 'Dingbats';
        if (cp >= 0x2800 && cp <= 0x28FF) return 'Braille Patterns';
        if (cp >= 0x2E80 && cp <= 0x2EFF) return 'CJK Radicals Supplement';
        if (cp >= 0x2F00 && cp <= 0x2FDF) return 'Kangxi Radicals';
        if (cp >= 0x3000 && cp <= 0x303F) return 'CJK Symbols and Punctuation';
        if (cp >= 0x3040 && cp <= 0x30FF) return 'Kana';
        if (cp >= 0x3400 && cp <= 0x4DBF) return 'CJK Unified Ideographs Extension A';
        if (cp >= 0x4E00 && cp <= 0x9FFF) return 'CJK Unified Ideographs';
        if (cp >= 0xAC00 && cp <= 0xD7AF) return 'Hangul Syllables';
        if (cp >= 0xFB00 && cp <= 0xFB4F) return 'Alphabetic Presentation Forms';
        if (cp >= 0xFE00 && cp <= 0xFE0F) return 'Variation Selectors';
        if (cp >= 0xFF00 && cp <= 0xFFEF) return 'Halfwidth and Fullwidth Forms';
        return 'Supplementary Planes';
      }

      function convertCharacter() {
        const char = charInput.value.trim();
        if (!char || char.length !== 1) {
          alert('请输入单个字符');
          charInput.focus();
          return;
        }

        const allResultElements = [
          unicodeDec, unicodeHex, unicodeCodepoint,
          utf8Bin, utf8Hex, utf8Length,
          utf16Bin, utf16Hex, utf16Length,
          asciiDec, asciiHex, asciiBin, asciiChar,
          charDisplay, charName, charBlock
        ];
        allResultElements.forEach(el => {
          el.classList.add('opacity-0');
          setTimeout(() => { el.classList.remove('opacity-0'); }, 250);
        });

        const codePoint = char.codePointAt(0);

        // 字符概览
        charDisplay.textContent = char;
        charName.textContent = getCharacterName(char);
        charBlock.textContent = getUnicodeBlock(char);

        // Unicode
        unicodeDec.textContent = codePoint.toString();
        unicodeHex.textContent = '0x' + toHex(codePoint, 4);
        unicodeCodepoint.textContent = 'U+' + toHex(codePoint, 4);

        // UTF-8
        const utf8Bytes = getUTF8Bytes(char);
        utf8Bin.textContent = utf8Bytes.map(b => toBinary(b, 8)).join(' ');
        utf8Hex.textContent = utf8Bytes.map(b => toHex(b, 2)).join(' ');
        utf8Length.textContent = utf8Bytes.length + ' 字节';

        // UTF-16
        const utf16Bytes = getUTF16Bytes(char);
        utf16Bin.textContent = utf16Bytes.map(b => toBinary(b, 8)).join(' ');
        utf16Hex.textContent = utf16Bytes.map(b => toHex(b, 2)).join(' ');
        utf16Length.textContent = utf16Bytes.length + ' 字节';


        // ASCII
        if (codePoint < 0x80) {
          asciiDec.textContent = codePoint.toString();
          asciiHex.textContent = '0x' + toHex(codePoint, 2);
          asciiBin.textContent = toBinary(codePoint, 8);
          if (codePoint >= 32 && codePoint <= 126) {
            asciiChar.textContent = `可打印字符 '${char}'`;
          } else if (codePoint === 10) {
            asciiChar.textContent = '换行符 (LF)';
          } else if (codePoint === 13) {
            asciiChar.textContent = '回车符 (CR)';
          } else if (codePoint === 9) {
            asciiChar.textContent = '制表符 (TAB)';
          } else if (codePoint === 32) {
            asciiChar.textContent = '空格';
          } else if (codePoint === 0x00) {
            asciiChar.textContent = '空字符 (NUL)';
          } else {
            asciiChar.textContent = '控制字符';
          }
        } else {
          asciiDec.textContent = '不支持';
          asciiHex.textContent = '不支持';
          asciiBin.textContent = '不支持';
          asciiChar.textContent = '非ASCII字符，无对应ASCII编码';
        }

      }

      convertBtn.addEventListener('click', convertCharacter);
      charInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') convertCharacter();
      });

      // 初始示例
      charInput.value = '中';
      setTimeout(convertCharacter, 300);
    });
  </script>
</body>
</html>